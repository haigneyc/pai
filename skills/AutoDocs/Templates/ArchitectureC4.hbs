# {{project.name}} Architecture

> C4 Model documentation for Personal AI Infrastructure

**Last Updated:** {{now}}

## Overview

{{project.description}}

PAI is designed around a modular, event-driven architecture that integrates deeply with Claude Code. The system emphasizes:

- **Modularity**: Skills can be added, removed, or updated independently
- **Observability**: All events are captured and can be monitored in real-time
- **Extensibility**: Hooks allow custom behavior at every lifecycle event
- **AI-First**: Designed to leverage AI for documentation, code generation, and automation

## Technology Stack

| Layer | Technology | Purpose |
|-------|------------|---------|
| Runtime | {{project.runtime}} | Fast JavaScript/TypeScript runtime |
| Language | TypeScript | Type-safe development |
| Templates | Handlebars | Dynamic content generation |
| Diagrams | Mermaid | Architecture visualization |
| AI | Anthropic Claude | AI-assisted generation |
| Frontend | Vue 3 + Vite | Observability dashboard |

## C4 Model Diagrams

### Level 1: System Context

Shows PAI in relation to users and external systems.

{{{diagrams.contextDiagram}}}

**Key External Systems:**
- **Claude Code**: The AI assistant CLI that loads and invokes PAI
- **Anthropic API**: Provides AI model access for generation tasks
- **Git/GitHub**: Version control and documentation sync

### Level 2: Container Diagram

Major subsystems within PAI and their interactions.

{{{diagrams.containerDiagram}}}

**Container Descriptions:**

| Container | Technology | Responsibility |
|-----------|------------|----------------|
| Skills System | TypeScript/Markdown | Modular capability definitions |
| Hook System | TypeScript/Bun | Event-driven automation |
| CLI Tools | TypeScript/Bun | Standalone utilities |
| History System | JSONL/Markdown | Session and activity tracking |
| Observability | Vue/Bun | Real-time monitoring |
| Configuration | JSON | System settings |

### Level 3: Component Diagrams

Detailed breakdown of each major container.

{{#each diagrams.componentDiagrams}}
#### {{name}}

{{{diagram}}}

{{/each}}

## Data Flow

### Session Lifecycle

```
User Input → Claude Code → PAI Skills
                ↓
        Hook Events Triggered
                ↓
    ┌───────────┼───────────┐
    ↓           ↓           ↓
 History    Observability  Tools
 (JSONL)    (Dashboard)    (CLI)
```

### Skill Loading Flow

```
Session Start
    ↓
load-core-context.ts hook
    ↓
Read skill-index.json
    ↓
Load "always" tier skills
    ↓
On-demand: Load "deferred" skills
```

## Installed Skills

{{#each skills}}
### {{name}}

**Path:** `{{path}}`

{{description}}

{{#if workflows.length}}
**Workflows:**
{{#each workflows}}
- `{{name}}`: {{trigger}}
{{/each}}
{{/if}}

{{#if tools.length}}
**Tools:**
{{#each tools}}
- `{{name}}`: {{description}}
{{/each}}
{{/if}}

{{/each}}

## Hook System

Hooks are triggered at various lifecycle events. All hooks are defined in `config/settings-hooks.json`.

| Hook | Events | Purpose |
|------|--------|---------|
{{#each hooks}}
| {{name}} | {{join eventTypes ", "}} | {{#if description}}{{truncate description 40}}{{else}}Event handler{{/if}} |
{{/each}}

### Event Types

- **SessionStart**: When a Claude Code session begins
- **SessionEnd**: When a session ends
- **PreToolUse**: Before a tool is invoked
- **PostToolUse**: After a tool completes
- **Stop**: When main agent stops
- **SubagentStop**: When a subagent completes
- **UserPromptSubmit**: When user submits input

## Directory Structure

```
pai/
{{#each directories}}
├── {{name}}/    # {{purpose}}
{{/each}}
├── .autodocs-state.json    # Documentation generation state
└── .env                    # Environment configuration
```

## Architectural Decisions

### Why Bun?

Bun provides faster startup times and native TypeScript support, which is critical for hooks that run on every Claude Code event.

### Why JSONL for History?

JSONL (JSON Lines) format allows:
- Append-only writes (no file locking)
- Easy streaming and tailing
- Line-by-line processing for large files

### Why Handlebars Templates?

Handlebars offers:
- Familiar mustache-style syntax
- Custom helpers for complex logic
- Separation of content from presentation

---

*Architecture documentation auto-generated by PAI AutoDocs*
